# tasks file for ./roles/docker/
- name: Create a test directory if it does not exist
  file:
    path: "{{ansible_user_dir }}/test"
    state: directory
    mode: '0755'
- name: Copy Dockerfile
  copy:
    src: Dockerfile
    dest: "{{ansible_user_dir }}/test/"
- name: Copy Blogger
  copy:
    src: Blogger
    dest: "{{ansible_user_dir }}/test/"

- name: Execute the command to build docker image
  shell: docker build -t blog:1 '{{ ansible_user_dir }}/test/.'

- name: Get infos on container
  shell: docker ps -a -f name=test1
  register: result

- name: result
  debug:
    msg: "{{result.stdout_lines|length }}"

- name: Execute the command to delete docker container
  shell: docker container rm test1 -f
  when: result.stdout_lines|length == 2


- name: Execute the command to run docker container
  shell: docker run -d -p {{params['port_number']}}:8000 --name test1 blog:1
